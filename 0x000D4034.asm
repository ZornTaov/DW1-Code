// waypoint stuff, navigate around obstacles
0x000D4034() {
  playerPtr = load(0x12F344)
  partnerPtr = load(0x12F348)
  partnerLocationPtr = load(partnerPtr + 0x04)
  
  playerTileX, playerTileY = getEntityTileFromModel(playerPtr)
  
  if(playerTileX != load(0x134D5C) || playerTileY != load(0x134D5B)) {
    partnerTileX, partnerTileY = getEntityTileFromModel(partnerPtr)
    
    if(isFiveTileWidePathOpen(playerTileX, playerTileY, partnerTileX, partnerTileY) == 1) {
      someVal1 = load(0x134D59)
      
      if(someVal1 != 0) {
        someVal2 = load(0x134D5A)
        prevOffset = (someVal2 + someVal1 - 1) % 30
        
        if(isFiveTileWidePathOpen(playerTileX, playerTileY, load(0x13D5F0 + prevOffset), load(0x13D5D0 + prevOffset)) == 1)
          storePreviousLocation(prevOffset + 1, load(0x134D5C), load(0x134D5B))
      }
      else
        clearPreviousLocations()
        storePreviousLocation(load(0x134D5A), load(0x134D5C), load(0x134D5B))
    }
    else
      clearPreviousLocations()
  }
  
  if(load(0x134D59) >= 2) {
    for(s0 = 0; s0 < 3; s0++) {
      offset = (load(0x134D5A) + load(0x134D59) - s0 - 2) % 30
      
      if(isFiveTileWidePathOpen(playerTileX, playerTileY, load(0x13D5F0 + offset), load(0x13D5D0 + offset)) == 0) {
        store(0x134D59, load(0x134D5A) - s0 - 1)
        break
      }
      
      if(load(0x134D5A) == offset)
        break
    }
  }
  
  if(load(0x134D59) != 0) {
    setTransformationMatrix(0x136F84)
    offset = load(0x134D5A)
    
    if(isTileWithinScreenArea(load(0x13D5F0 + offset), load(0x13D5D0 + offset)) != 0) {
      
      if(load(partnerPtr + 0x35) == 0) {
        offset = load(0x134D5A)
        
        locX = (load(0x13D5F0 + offset) - 50) * 100 + 50
        locY = (50 - load(0x13D5D0 + offset)) * 100 - 50
        
        store(partnerLocationPtr + 0x78, locX)
        store(partnerLocationPtr + 0x80, locY)
        
        store(partnerPtr + 0x10, locX / 32768)
        store(partnerPtr + 0x18, locY / 32768)
        
        pollStoredLocation() // TODO
      }
    }
  }
  
  state = load(0x134F0A)
  if(state == 0 || state == 3) {
    rotation = load(partnerLocationPtr + 0x72)
    
    if(load(0x134D59) != 0) {
      partnerModelTileX, partnerModelTileY = getModelTile(partnerLocationPtr + 0x78)
      offset = load(0x124D5A)
      
      entityLookAtTile(partnerPtr, load(0x13D5F0 + offset), load(0x13D5D0 + offset))
      
      if(load(0x13D5F0 + offset) == partnerModelTileX && partnerModelTileY == load(0x13D5D0 + offset))
        pollStoredLocation() // TODO
    }
    else {
      playerLocationPtr = load(playerPtr + 0x04)
      entityLookAtLocation(partnerPtr, playerLocationPtr + 0x78)
    }
  }
  
  collisionResponse = entityCheckCollision(0, partnerPtr, 0, 0)
  
  if(collisionResponse >= 0 && collisionResponse < 10) {
    if(load(0x134F0A) != 3) {
      store(partnerLocationPtr + 0x72, rotation)
      0x000D4884(playerPtr, partnerPtr, 0, 0) // TODO
    }
    else if(collisionResponse != 0)
      startBattleIdleAnimation(0x1557A8, 0x1557E0, 0)
  }
  else if(load(0x134F0A) == 3 && entityIsInEntity(playerPtr, partnerPtr) == 1)
    handleBattleIdle(0x1557A8, 0x1557E0, 0)
  
  store(0x134D5C, playerTileX)
  store(0x134D5B, playerTileY)
}

0x000d4034 addiu sp,sp,0xffd8
0x000d4038 sw ra,0x001c(sp)
0x000d403c sw s2,0x0018(sp)
0x000d4040 lui asmTemp,0x8013
0x000d4044 sw s1,0x0014(sp)
0x000d4048 lw a0,-0x0cbc(asmTemp)
0x000d404c sw s0,0x0010(sp)
0x000d4050 addiu a1,sp,0x0024
0x000d4054 jal 0x000d3aec
0x000d4058 addiu a2,sp,0x0025
0x000d405c lb v1,0x0024(sp)
0x000d4060 lb v0,-0x6dd0(gp)
0x000d4064 nop
0x000d4068 bne v1,v0,0x000d4084
0x000d406c nop
0x000d4070 lb v1,0x0025(sp)
0x000d4074 lb v0,-0x6dd1(gp)
0x000d4078 nop
0x000d407c beq v1,v0,0x000d4188
0x000d4080 nop
0x000d4084 lui asmTemp,0x8013
0x000d4088 lw a0,-0x0cb8(asmTemp)
0x000d408c addiu a1,sp,0x0026
0x000d4090 jal 0x000d3aec
0x000d4094 addiu a2,sp,0x0027
0x000d4098 lb a0,0x0024(sp)
0x000d409c lb a1,0x0025(sp)
0x000d40a0 lb a2,0x0026(sp)
0x000d40a4 lb a3,0x0027(sp)
0x000d40a8 jal 0x000d3b44
0x000d40ac nop
0x000d40b0 addiu asmTemp,r0,0x0001
0x000d40b4 bne v0,asmTemp,0x000d4180
0x000d40b8 nop
0x000d40bc lb v0,-0x6dd3(gp)
0x000d40c0 nop
0x000d40c4 beq v0,r0,0x000d415c
0x000d40c8 addu v1,v0,r0
0x000d40cc lb v0,-0x6dd2(gp)
0x000d40d0 lb a0,0x0024(sp)
0x000d40d4 add v0,v0,v1
0x000d40d8 addi v1,v0,-0x0001
0x000d40dc addiu v0,r0,0x001e
0x000d40e0 div v1,v0
0x000d40e4 mfhi v0
0x000d40e8 sll a1,v0,0x10
0x000d40ec lui v0,0x8014
0x000d40f0 sra a1,a1,0x10
0x000d40f4 addiu v0,v0,0xd5f0
0x000d40f8 addu v1,v0,a1
0x000d40fc lui v0,0x8014
0x000d4100 addiu v0,v0,0xd5d0
0x000d4104 addu v0,v0,a1
0x000d4108 lb a1,0x0025(sp)
0x000d410c lb a2,0x0000(v1)
0x000d4110 lb a3,0x0000(v0)
0x000d4114 jal 0x000d3b44
0x000d4118 nop
0x000d411c addiu asmTemp,r0,0x0001
0x000d4120 bne v0,asmTemp,0x000d4188
0x000d4124 nop
0x000d4128 lb v1,-0x6dd2(gp)
0x000d412c lb v0,-0x6dd3(gp)
0x000d4130 lb a1,-0x6dd0(gp)
0x000d4134 add v1,v1,v0
0x000d4138 addiu v0,r0,0x001e
0x000d413c div v1,v0
0x000d4140 lb a2,-0x6dd1(gp)
0x000d4144 mfhi v0
0x000d4148 sll a0,v0,0x10
0x000d414c jal 0x000d4564
0x000d4150 sra a0,a0,0x10
0x000d4154 beq r0,r0,0x000d4188
0x000d4158 nop
0x000d415c jal 0x000d39f8
0x000d4160 nop
0x000d4164 lb a0,-0x6dd2(gp)
0x000d4168 lb a1,-0x6dd0(gp)
0x000d416c lb a2,-0x6dd1(gp)
0x000d4170 jal 0x000d4564
0x000d4174 nop
0x000d4178 beq r0,r0,0x000d4188
0x000d417c nop
0x000d4180 jal 0x000d39f8
0x000d4184 nop
0x000d4188 lb v0,-0x6dd3(gp)
0x000d418c nop
0x000d4190 slti asmTemp,v0,0x0002
0x000d4194 bne asmTemp,r0,0x000d4244
0x000d4198 nop
0x000d419c beq r0,r0,0x000d4238
0x000d41a0 addu s0,r0,r0
0x000d41a4 lb v1,-0x6dd2(gp)
0x000d41a8 lb v0,-0x6dd3(gp)
0x000d41ac lb a0,0x0024(sp)
0x000d41b0 add v0,v1,v0
0x000d41b4 addi v0,v0,-0x0002
0x000d41b8 sub v1,v0,s0
0x000d41bc addiu v0,r0,0x001e
0x000d41c0 div v1,v0
0x000d41c4 mfhi v0
0x000d41c8 sll s1,v0,0x10
0x000d41cc sra s1,s1,0x10
0x000d41d0 lui v0,0x8014
0x000d41d4 addu a1,s1,r0
0x000d41d8 addiu v0,v0,0xd5f0
0x000d41dc addu v1,v0,a1
0x000d41e0 lui v0,0x8014
0x000d41e4 addiu v0,v0,0xd5d0
0x000d41e8 addu v0,v0,a1
0x000d41ec lb a1,0x0025(sp)
0x000d41f0 lb a2,0x0000(v1)
0x000d41f4 lb a3,0x0000(v0)
0x000d41f8 jal 0x000d3b44
0x000d41fc nop
0x000d4200 bne v0,r0,0x000d4224
0x000d4204 nop
0x000d4208 addi v1,s0,0x0001
0x000d420c sll v1,v1,0x18
0x000d4210 lb v0,-0x6dd3(gp)
0x000d4214 sra v1,v1,0x18
0x000d4218 sub v0,v0,v1
0x000d421c beq r0,r0,0x000d4244
0x000d4220 sb v0,-0x6dd3(gp)
0x000d4224 lb v0,-0x6dd2(gp)
0x000d4228 nop
0x000d422c beq s1,v0,0x000d4244
0x000d4230 nop
0x000d4234 addi s0,s0,0x0001
0x000d4238 slti asmTemp,s0,0x0003
0x000d423c bne asmTemp,r0,0x000d41a4
0x000d4240 nop
0x000d4244 lb v0,-0x6dd3(gp)
0x000d4248 nop
0x000d424c beq v0,r0,0x000d4358
0x000d4250 nop
0x000d4254 lui a0,0x8013
0x000d4258 jal 0x00097dd8
0x000d425c addiu a0,a0,0x6f84
0x000d4260 lui v0,0x8014
0x000d4264 lb a1,-0x6dd2(gp)
0x000d4268 addiu v0,v0,0xd5f0
0x000d426c addu v1,v0,a1
0x000d4270 lui v0,0x8014
0x000d4274 addiu v0,v0,0xd5d0
0x000d4278 addu v0,v0,a1
0x000d427c lb a0,0x0000(v1)
0x000d4280 lb a1,0x0000(v0)
0x000d4284 jal 0x000d3078
0x000d4288 nop
0x000d428c beq v0,r0,0x000d4358
0x000d4290 nop
0x000d4294 lui asmTemp,0x8013
0x000d4298 lw v0,-0x0cb8(asmTemp)
0x000d429c nop
0x000d42a0 lb v1,0x0035(v0)
0x000d42a4 nop
0x000d42a8 bne v1,r0,0x000d4358
0x000d42ac nop
0x000d42b0 lb a0,-0x6dd2(gp)
0x000d42b4 lui v1,0x8014
0x000d42b8 addiu v1,v1,0xd5f0
0x000d42bc addu v1,v1,a0
0x000d42c0 lb v1,0x0000(v1)
0x000d42c4 addu a2,a0,r0
0x000d42c8 addi a0,v1,-0x0032
0x000d42cc sll v1,a0,0x02
0x000d42d0 add a0,v1,a0
0x000d42d4 sll v1,a0,0x02
0x000d42d8 add v1,a0,v1
0x000d42dc sll v1,v1,0x02
0x000d42e0 addi a1,v1,0x0032
0x000d42e4 lui v1,0x8014
0x000d42e8 addiu v1,v1,0xd5d0
0x000d42ec addu v1,v1,a2
0x000d42f0 lb a0,0x0000(v1)
0x000d42f4 lw v0,0x0004(v0)
0x000d42f8 addiu v1,r0,0x0032
0x000d42fc sub a0,v1,a0
0x000d4300 sll v1,a0,0x02
0x000d4304 add a0,v1,a0
0x000d4308 sll v1,a0,0x02
0x000d430c add v1,a0,v1
0x000d4310 sll v1,v1,0x02
0x000d4314 addi a0,v1,-0x0032
0x000d4318 sw a1,0x0078(v0)
0x000d431c lui asmTemp,0x8013
0x000d4320 lw v0,-0x0cb8(asmTemp)
0x000d4324 sll v1,a1,0x0f
0x000d4328 lw v0,0x0004(v0)
0x000d432c lui asmTemp,0x8013
0x000d4330 sw a0,0x0080(v0)
0x000d4334 lw v0,-0x0cb8(asmTemp)
0x000d4338 nop
0x000d433c sw v1,0x0010(v0)
0x000d4340 lui asmTemp,0x8013
0x000d4344 lw v0,-0x0cb8(asmTemp)
0x000d4348 sll v1,a0,0x0f
0x000d434c sw v1,0x0018(v0)
0x000d4350 jal 0x000d3174
0x000d4354 nop
0x000d4358 lb v0,-0x6c22(gp)
0x000d435c nop
0x000d4360 beq v0,r0,0x000d4374
0x000d4364 addu v1,v0,r0
0x000d4368 addiu asmTemp,r0,0x0003
0x000d436c bne v1,asmTemp,0x000d4444
0x000d4370 nop
0x000d4374 lui asmTemp,0x8013
0x000d4378 lw a0,-0x0cb8(asmTemp)
0x000d437c lb v0,-0x6dd3(gp)
0x000d4380 lw v1,0x0004(a0)
0x000d4384 nop
0x000d4388 lh s2,0x0072(v1)
0x000d438c beq v0,r0,0x000d442c
0x000d4390 nop
0x000d4394 addiu a0,v1,0x0078
0x000d4398 addiu a1,sp,0x0020
0x000d439c jal 0x000c0f28
0x000d43a0 addiu a2,sp,0x0022
0x000d43a4 lui v0,0x8014
0x000d43a8 lui asmTemp,0x8013
0x000d43ac lb v1,-0x6dd2(gp)
0x000d43b0 addiu v0,v0,0xd5f0
0x000d43b4 addu v0,v0,v1
0x000d43b8 lb a1,0x0000(v0)
0x000d43bc lw a0,-0x0cb8(asmTemp)
0x000d43c0 lui v0,0x8014
0x000d43c4 addiu v0,v0,0xd5d0
0x000d43c8 addu v0,v0,v1
0x000d43cc lb a2,0x0000(v0)
0x000d43d0 jal 0x000e6078
0x000d43d4 nop
0x000d43d8 lb v1,-0x6dd2(gp)
0x000d43dc lui v0,0x8014
0x000d43e0 addiu v0,v0,0xd5f0
0x000d43e4 addu v0,v0,v1
0x000d43e8 lh a0,0x0020(sp)
0x000d43ec lb v0,0x0000(v0)
0x000d43f0 nop
0x000d43f4 bne a0,v0,0x000d4444
0x000d43f8 addu a1,v1,r0
0x000d43fc lui v0,0x8014
0x000d4400 addiu v0,v0,0xd5d0
0x000d4404 addu v0,v0,a1
0x000d4408 lh v1,0x0022(sp)
0x000d440c lb v0,0x0000(v0)
0x000d4410 nop
0x000d4414 bne v1,v0,0x000d4444
0x000d4418 nop
0x000d441c jal 0x000d3174
0x000d4420 nop
0x000d4424 beq r0,r0,0x000d4444
0x000d4428 nop
0x000d442c lui asmTemp,0x8013
0x000d4430 lw v0,-0x0cbc(asmTemp)
0x000d4434 nop
0x000d4438 lw v0,0x0004(v0)
0x000d443c jal 0x000d459c
0x000d4440 addiu a1,v0,0x0078
0x000d4444 lui asmTemp,0x8013
0x000d4448 lw a1,-0x0cb8(asmTemp)
0x000d444c addu a0,r0,r0
0x000d4450 addu a2,r0,r0
0x000d4454 jal 0x000d45ec
0x000d4458 addu a3,r0,r0
0x000d445c sll v1,v0,0x10
0x000d4460 sra v1,v1,0x10
0x000d4464 slt asmTemp,v1,r0
0x000d4468 bne asmTemp,r0,0x000d44e8
0x000d446c nop
0x000d4470 slti asmTemp,v1,0x000a
0x000d4474 beq asmTemp,r0,0x000d44e8
0x000d4478 nop
0x000d447c lb v0,-0x6c22(gp)
0x000d4480 addiu asmTemp,r0,0x0003
0x000d4484 beq v0,asmTemp,0x000d44c0
0x000d4488 nop
0x000d448c lui asmTemp,0x8013
0x000d4490 lw v0,-0x0cb8(asmTemp)
0x000d4494 addu a2,r0,r0
0x000d4498 lw v0,0x0004(v0)
0x000d449c lui asmTemp,0x8013
0x000d44a0 sh s2,0x0072(v0)
0x000d44a4 lw a0,-0x0cbc(asmTemp)
0x000d44a8 lui asmTemp,0x8013
0x000d44ac lw a1,-0x0cb8(asmTemp)
0x000d44b0 jal 0x000d4884
0x000d44b4 addu a3,r0,r0
0x000d44b8 beq r0,r0,0x000d4538
0x000d44bc lb v0,0x0024(sp)
0x000d44c0 bne v1,r0,0x000d4534
0x000d44c4 nop
0x000d44c8 lui a0,0x8015
0x000d44cc lui a1,0x8015
0x000d44d0 addiu a0,a0,0x57a8
0x000d44d4 addiu a1,a1,0x57e0
0x000d44d8 jal 0x000e8970
0x000d44dc addu a2,r0,r0
0x000d44e0 beq r0,r0,0x000d4538
0x000d44e4 lb v0,0x0024(sp)
0x000d44e8 lb v0,-0x6c22(gp)
0x000d44ec addiu asmTemp,r0,0x0003
0x000d44f0 bne v0,asmTemp,0x000d4534
0x000d44f4 nop
0x000d44f8 lui asmTemp,0x8013
0x000d44fc lw a0,-0x0cbc(asmTemp)
0x000d4500 lui asmTemp,0x8013
0x000d4504 lw a1,-0x0cb8(asmTemp)
0x000d4508 jal 0x000d31ac
0x000d450c nop
0x000d4510 addiu asmTemp,r0,0x0001
0x000d4514 bne v0,asmTemp,0x000d4534
0x000d4518 nop
0x000d451c lui a0,0x8015
0x000d4520 lui a1,0x8015
0x000d4524 addiu a0,a0,0x57a8
0x000d4528 addiu a1,a1,0x57e0
0x000d452c jal 0x000e7d40
0x000d4530 addu a2,r0,r0
0x000d4534 lb v0,0x0024(sp)
0x000d4538 nop
0x000d453c sb v0,-0x6dd0(gp)
0x000d4540 lb v0,0x0025(sp)
0x000d4544 nop
0x000d4548 sb v0,-0x6dd1(gp)
0x000d454c lw ra,0x001c(sp)
0x000d4550 lw s2,0x0018(sp)
0x000d4554 lw s1,0x0014(sp)
0x000d4558 lw s0,0x0010(sp)
0x000d455c jr ra
0x000d4560 addiu sp,sp,0x0028