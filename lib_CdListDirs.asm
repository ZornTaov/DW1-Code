int lib_CdListDirs() {
  logLevel = load(0x123724) // 0 = off, 1 = error, 2 = info, 3 = verbose
  
  // read partition
  if(lib_CdReadFromSector(1, 16, 0x13B810) != 1) {
    if(logLevel > 0)
      printf(0x1146F0) // "CD_newmedia: Read error in cd_read(PVD)"
    
    return 0
  }
  
  if(strncmp(0x13B811, 0x11471C, 5) != 0) { // "CD001"
    if(logLevel > 0)
      printf(0x114724) // "CD_newmedia: Disc format error in cd_read(PVD)"
      
    return 0
  }
  
  store(sp + 0x18, load(0x13B810 + 0x8C))
  
  // read root dir
  if(lib_CdReadFromSector(1, load(sp + 0x18), 0x13B810) != 1) {
    if(logLevel > 0)
      printf(0x114754, load(sp + 0x18)) // "CD_newmedia: Read error (PT:%08x)"
    
    return 0
  }
  
  if(logLevel >= 2)
    printf(0x114778) // "CD_newmedia: sarching dir" [sic]
  
  pathTablePtr = 0x13B810
  dirId = 0
  
  while(pathTablePtr < 0x13C010) { // make sure the local dir table only take up 2048 bytes
    if(load(pathTablePtr) == 0)
      break
    
    dirTablePtr = 0x13A210 + dirId++ * 0x2C
    
    parentId = load(pathTablePtr + 0x06)
    lba = load(pathTablePtr + 0x02)
    
    store(dirTablePtr + 0x00, dirId)
    store(dirTablePtr + 0x04, parentId)
    store(dirTablePtr + 0x08, lba)
    
    nameLen = load(pathTablePtr)
    memcpy(dirTablePtr + 0x0C, pathTablePtr + 0x08, nameLen)
    store(dirTablePtr + 0x0C + nameLen, 0)
    
    // advance by entry size and padding
    pathTablePtr = pathTablePtr + 0x08 + nameLen + nameLen & 1
    
    // Sector, Id, Parent, Name
    if(logLevel >= 2)
      printf(0x114798, lba, dirId, parentId, dirTablePtr + 0x0C) // "%08x,%04x,%04x,%s"
    
    if(dirId >= 0x80)
      break
  }
  
  if(dirId < 0x80)
    store(0x13A214 + dirId * 44, 0)
  
  store(0x1237E0, 0)
  
  if(logLevel >= 2)
    printf(0x1147AC, a1) // "CD_newmedia: %d dir entries found"
  
  return 1
}

0x000b1d48 addiu sp,sp,0xffc0
0x000b1d4c addiu a0,r0,0x0001
0x000b1d50 addiu a1,r0,0x0010
0x000b1d54 sw s0,0x0020(sp)
0x000b1d58 lui s0,0x8014
0x000b1d5c addiu s0,s0,0xb810
0x000b1d60 addu a2,s0,r0
0x000b1d64 sw ra,0x003c(sp)
0x000b1d68 sw s6,0x0038(sp)
0x000b1d6c sw s5,0x0034(sp)
0x000b1d70 sw s4,0x0030(sp)
0x000b1d74 sw s3,0x002c(sp)
0x000b1d78 sw s2,0x0028(sp)
0x000b1d7c jal 0x000b234c
0x000b1d80 sw s1,0x0024(sp)
0x000b1d84 addu s1,v0,r0
0x000b1d88 addiu v0,r0,0x0001
0x000b1d8c beq s1,v0,0x000b1dbc
0x000b1d90 addiu a0,s0,0x0001
0x000b1d94 lui v0,0x8012
0x000b1d98 lw v0,0x3724(v0)
0x000b1d9c nop
0x000b1da0 blez v0,0x000b1fe4
0x000b1da4 addu v0,r0,r0
0x000b1da8 lui a0,0x8011
0x000b1dac jal 0x0009128c
0x000b1db0 addiu a0,a0,0x46f0
0x000b1db4 j 0x000b1fe4
0x000b1db8 addu v0,r0,r0
0x000b1dbc lui a1,0x8011
0x000b1dc0 addiu a1,a1,0x471c
0x000b1dc4 jal 0x000911ec
0x000b1dc8 addiu a2,r0,0x0005
0x000b1dcc beq v0,r0,0x000b1dfc
0x000b1dd0 nop
0x000b1dd4 lui v0,0x8012
0x000b1dd8 lw v0,0x3724(v0)
0x000b1ddc nop
0x000b1de0 blez v0,0x000b1fe4
0x000b1de4 addu v0,r0,r0
0x000b1de8 lui a0,0x8011
0x000b1dec jal 0x0009128c
0x000b1df0 addiu a0,a0,0x4724
0x000b1df4 j 0x000b1fe4
0x000b1df8 addu v0,r0,r0
0x000b1dfc lwl v0,0x008f(s0)
0x000b1e00 lwr v0,0x008c(s0)
0x000b1e04 nop
0x000b1e08 swl v0,0x001b(sp)
0x000b1e0c swr v0,0x0018(sp)
0x000b1e10 addiu a0,r0,0x0001
0x000b1e14 lw a1,0x0018(sp)
0x000b1e18 jal 0x000b234c
0x000b1e1c addu a2,s0,r0
0x000b1e20 beq v0,s1,0x000b1e54
0x000b1e24 nop
0x000b1e28 lui v0,0x8012
0x000b1e2c lw v0,0x3724(v0)
0x000b1e30 nop
0x000b1e34 blez v0,0x000b1fe4
0x000b1e38 addu v0,r0,r0
0x000b1e3c lw a1,0x0018(sp)
0x000b1e40 lui a0,0x8011
0x000b1e44 jal 0x0009128c
0x000b1e48 addiu a0,a0,0x4754
0x000b1e4c j 0x000b1fe4
0x000b1e50 addu v0,r0,r0
0x000b1e54 lui v0,0x8012
0x000b1e58 lw v0,0x3724(v0)
0x000b1e5c nop
0x000b1e60 slti v0,v0,0x0002
0x000b1e64 bne v0,r0,0x000b1e78
0x000b1e68 addu s1,s0,r0
0x000b1e6c lui a0,0x8011
0x000b1e70 jal 0x0009128c
0x000b1e74 addiu a0,a0,0x4778
0x000b1e78 addiu v1,s1,0x0800
0x000b1e7c sltu v0,s1,v1
0x000b1e80 beq v0,r0,0x000b1f8c
0x000b1e84 addu a3,r0,r0
0x000b1e88 lui s4,0x8014
0x000b1e8c addiu s4,s4,0xa218
0x000b1e90 addiu s6,s4,0x0004
0x000b1e94 addu s5,v1,r0
0x000b1e98 lbu v0,0x0000(s1)
0x000b1e9c nop
0x000b1ea0 beq v0,r0,0x000b1f8c
0x000b1ea4 sll v0,a3,0x01
0x000b1ea8 addu v0,v0,a3
0x000b1eac sll v0,v0,0x02
0x000b1eb0 subu v0,v0,a3
0x000b1eb4 sll s0,v0,0x02
0x000b1eb8 addu v0,s0,s4
0x000b1ebc lwl v1,0x0005(s1)
0x000b1ec0 lwr v1,0x0002(s1)
0x000b1ec4 nop
0x000b1ec8 swl v1,0x0003(v0)
0x000b1ecc swr v1,0x0000(v0)
0x000b1ed0 addu s2,s0,s6
0x000b1ed4 addu a0,s2,r0
0x000b1ed8 lbu v0,0x0006(s1)
0x000b1edc addiu s3,a3,0x0001
0x000b1ee0 lui asmTemp,0x8014
0x000b1ee4 addu asmTemp,asmTemp,s0
0x000b1ee8 sw s3,-0x5df0(asmTemp)
0x000b1eec lui asmTemp,0x8014
0x000b1ef0 addu asmTemp,asmTemp,s0
0x000b1ef4 sw v0,-0x5dec(asmTemp)
0x000b1ef8 lbu a2,0x0000(s1)
0x000b1efc jal 0x0009124c
0x000b1f00 addiu a1,s1,0x0008
0x000b1f04 lbu v0,0x0000(s1)
0x000b1f08 nop
0x000b1f0c addu v0,s2,v0
0x000b1f10 sb r0,0x0000(v0)
0x000b1f14 lbu v1,0x0000(s1)
0x000b1f18 nop
0x000b1f1c andi v0,v1,0x0001
0x000b1f20 addiu v0,v0,0x0008
0x000b1f24 addu v1,v1,v0
0x000b1f28 lui v0,0x8012
0x000b1f2c lw v0,0x3724(v0)
0x000b1f30 nop
0x000b1f34 slti v0,v0,0x0002
0x000b1f38 bne v0,r0,0x000b1f74
0x000b1f3c addu s1,s1,v1
0x000b1f40 lui a1,0x8014
0x000b1f44 addu a1,a1,s0
0x000b1f48 lw a1,-0x5de8(a1)
0x000b1f4c lui a2,0x8014
0x000b1f50 addu a2,a2,s0
0x000b1f54 lw a2,-0x5df0(a2)
0x000b1f58 lui a3,0x8014
0x000b1f5c addu a3,a3,s0
0x000b1f60 lw a3,-0x5dec(a3)
0x000b1f64 lui a0,0x8011
0x000b1f68 addiu a0,a0,0x4798
0x000b1f6c jal 0x0009128c
0x000b1f70 sw s2,0x0010(sp)
0x000b1f74 addu a3,s3,r0
0x000b1f78 slti v0,a3,0x0080
0x000b1f7c beq v0,r0,0x000b1fb4
0x000b1f80 sltu v0,s1,s5
0x000b1f84 bne v0,r0,0x000b1e98
0x000b1f88 nop
0x000b1f8c slti v0,a3,0x0080
0x000b1f90 beq v0,r0,0x000b1fb4
0x000b1f94 sll v0,a3,0x01
0x000b1f98 addu v0,v0,a3
0x000b1f9c sll v0,v0,0x02
0x000b1fa0 subu v0,v0,a3
0x000b1fa4 sll v0,v0,0x02
0x000b1fa8 lui asmTemp,0x8014
0x000b1fac addu asmTemp,asmTemp,v0
0x000b1fb0 sw r0,-0x5dec(asmTemp)
0x000b1fb4 lui v0,0x8012
0x000b1fb8 lw v0,0x3724(v0)
0x000b1fbc lui asmTemp,0x8012
0x000b1fc0 sw r0,0x37e0(asmTemp)
0x000b1fc4 slti v0,v0,0x0002
0x000b1fc8 bne v0,r0,0x000b1fe4
0x000b1fcc addiu v0,r0,0x0001
0x000b1fd0 lui a0,0x8011
0x000b1fd4 addiu a0,a0,0x47ac
0x000b1fd8 jal 0x0009128c
0x000b1fdc addu a1,a3,r0
0x000b1fe0 addiu v0,r0,0x0001
0x000b1fe4 lw ra,0x003c(sp)
0x000b1fe8 lw s6,0x0038(sp)
0x000b1fec lw s5,0x0034(sp)
0x000b1ff0 lw s4,0x0030(sp)
0x000b1ff4 lw s3,0x002c(sp)
0x000b1ff8 lw s2,0x0028(sp)
0x000b1ffc lw s1,0x0024(sp)
0x000b2000 lw s0,0x0020(sp)
0x000b2004 jr ra
0x000b2008 addiu sp,sp,0x0040