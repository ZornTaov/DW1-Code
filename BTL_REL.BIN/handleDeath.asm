void handleDeath(int entityPtr, int combatPtr, int combatId) {
  store(entityPtr + 0x53, 1)
  flags = load(combatPtr + 0x34) | 0x8000 // set isDead flag
  store(combatPtr + 0x34, flags)
  
  startAnimation(entityPtr, 0x2B)
  resetFlatten(combatId)
  removeEffectSprites(entityPtr, combatPtr)
  
  // clear status flags, set "transforming" flag
  flags = (load(combatPtr + 0x34) & 0xFF40) | 0x0040
  store(combatPtr + 0x34, flags)
  store(combatPtr + 0x36, -1)
  
  resetDumbCooldownTimers(combatPtr)
}

0x0005afd8 addiu sp,sp,0xffe0
0x0005afdc sw ra,0x001c(sp)
0x0005afe0 sw s2,0x0018(sp)
0x0005afe4 sw s1,0x0014(sp)
0x0005afe8 sw s0,0x0010(sp)
0x0005afec addu s0,a1,r0
0x0005aff0 addu s1,a0,r0
0x0005aff4 addiu v0,r0,0x0001
0x0005aff8 sb v0,0x0053(s1)
0x0005affc lhu v0,0x0034(s0)
0x0005b000 addu s2,a2,r0
0x0005b004 ori v0,v0,0x8000
0x0005b008 sh v0,0x0034(s0)
0x0005b00c jal 0x000c1a04
0x0005b010 addiu a1,r0,0x002b
0x0005b014 jal 0x00059078
0x0005b018 addu a0,s2,r0
0x0005b01c addu a0,s1,r0
0x0005b020 jal 0x0005ec7c
0x0005b024 addu a1,s0,r0
0x0005b028 lhu v0,0x0034(s0)
0x0005b02c nop
0x0005b030 andi v0,v0,0xff40
0x0005b034 sh v0,0x0034(s0)
0x0005b038 lhu v0,0x0034(s0)
0x0005b03c nop
0x0005b040 ori v0,v0,0x0040
0x0005b044 sh v0,0x0034(s0)
0x0005b048 addiu v0,r0,0xffff
0x0005b04c sb v0,0x0036(s0)
0x0005b050 jal 0x0005eb0c
0x0005b054 addu a0,s0,r0
0x0005b058 lw ra,0x001c(sp)
0x0005b05c lw s2,0x0018(sp)
0x0005b060 lw s1,0x0014(sp)
0x0005b064 lw s0,0x0010(sp)
0x0005b068 jr ra
0x0005b06c addiu sp,sp,0x0020